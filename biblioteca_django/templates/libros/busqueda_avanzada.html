{% extends 'base/base.html' %}
{% load static %}

{% block title %}Búsqueda Avanzada - Biblioteca Django{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">
        <i class="fas fa-search text-primary"></i> Búsqueda Avanzada
    </h1>

    <!-- Formulario de Búsqueda Avanzada -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-filter"></i> Filtros de Búsqueda</h5>
        </div>
        <div class="card-body">
            <form method="GET" action="{% url 'libros:busqueda_avanzada' %}">
                <div class="row g-3">
                    <!-- Título -->
                    <div class="col-md-6">
                        <label for="titulo" class="form-label">Título</label>
                        <input type="text" class="form-control" id="titulo" name="titulo" 
                               placeholder="Buscar por título..." value="{{ filtros.titulo }}">
                    </div>

                    <!-- Autor -->
                    <div class="col-md-6">
                        <label for="autor" class="form-label">Autor</label>
                        <input type="text" class="form-control" id="autor" name="autor" 
                               placeholder="Nombre del autor..." value="{{ filtros.autor }}">
                    </div>

                    <!-- Categoría -->
                    <div class="col-md-4">
                        <label for="categoria" class="form-label">Categoría</label>
                        <select class="form-select" id="categoria" name="categoria">
                            <option value="">Todas las categorías</option>
                            {% for cat in categorias %}
                            <option value="{{ cat.id }}" {% if filtros.categoria == cat.id|stringformat:"s" %}selected{% endif %}>
                                {{ cat.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Editorial -->
                    <div class="col-md-4">
                        <label for="editorial" class="form-label">Editorial</label>
                        <select class="form-select" id="editorial" name="editorial">
                            <option value="">Todas las editoriales</option>
                            {% for edit in editoriales %}
                            <option value="{{ edit.id }}" {% if filtros.editorial == edit.id|stringformat:"s" %}selected{% endif %}>
                                {{ edit.nombre }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Calificación Mínima -->
                    <div class="col-md-4">
                        <label for="calificacion_min" class="form-label">Calificación Mínima</label>
                        <select class="form-select" id="calificacion_min" name="calificacion_min">
                            <option value="">Todas</option>
                            <option value="5.0" {% if filtros.calificacion_min == "5.0" %}selected{% endif %}>5 Estrellas</option>
                            <option value="4.0" {% if filtros.calificacion_min == "4.0" %}selected{% endif %}>4+ Estrellas</option>
                            <option value="3.0" {% if filtros.calificacion_min == "3.0" %}selected{% endif %}>3+ Estrellas</option>
                            <option value="2.0" {% if filtros.calificacion_min == "2.0" %}selected{% endif %}>2+ Estrellas</option>
                        </select>
                    </div>

                    <!-- Año Desde -->
                    <div class="col-md-3">
                        <label for="año_desde" class="form-label">Año Desde</label>
                        <input type="number" class="form-control" id="año_desde" name="año_desde" 
                               placeholder="2000" min="1900" max="2026" value="{{ filtros.año_desde }}">
                    </div>

                    <!-- Año Hasta -->
                    <div class="col-md-3">
                        <label for="año_hasta" class="form-label">Año Hasta</label>
                        <input type="number" class="form-control" id="año_hasta" name="año_hasta" 
                               placeholder="2026" min="1900" max="2026" value="{{ filtros.año_hasta }}">
                    </div>

                    <!-- Precio Mínimo -->
                    <div class="col-md-3">
                        <label for="precio_min" class="form-label">Precio Mínimo ($)</label>
                        <input type="number" class="form-control" id="precio_min" name="precio_min" 
                               placeholder="0" step="0.01" min="0" value="{{ filtros.precio_min }}">
                    </div>

                    <!-- Precio Máximo -->
                    <div class="col-md-3">
                        <label for="precio_max" class="form-label">Precio Máximo ($)</label>
                        <input type="number" class="form-control" id="precio_max" name="precio_max" 
                               placeholder="1000" step="0.01" min="0" value="{{ filtros.precio_max }}">
                    </div>

                    <!-- Botones -->
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                        <a href="{% url 'libros:busqueda_avanzada' %}" class="btn btn-secondary">
                            <i class="fas fa-redo"></i> Limpiar Filtros
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Resultados -->
    <div class="mb-3">
        <h4>
            <i class="fas fa-list"></i> Resultados de la Búsqueda
            <span class="badge bg-primary">{{ libros.count }} libro(s)</span>
        </h4>
    </div>

    <div class="row">
        {% for libro in libros %}
        <div class="col-md-6 col-lg-3 mb-4">
            <div class="card h-100 shadow-sm libro-card">
                {% if libro.portada %}
                <img src="{{ libro.portada.url }}" class="card-img-top" alt="{{ libro.titulo }}" 
                     style="height: 250px; object-fit: cover;">
                {% else %}
                <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center" 
                     style="height: 250px;">
                    <i class="fas fa-book fa-4x text-white"></i>
                </div>
                {% endif %}
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ libro.titulo|truncatewords:6 }}</h5>
                    <p class="card-text text-muted">
                        <i class="fas fa-user"></i> {{ libro.autor.nombre }}
                    </p>
                    <p class="card-text small">
                        <i class="fas fa-calendar"></i> {{ libro.fecha_publicacion|date:"Y" }}
                    </p>
                    
                    <div class="mb-2">
                        <span class="badge bg-warning text-dark">
                            <i class="fas fa-star"></i> {{ libro.calificacion }}
                        </span>
                    </div>
                    
                    <div class="mb-2">
                        <strong class="text-primary">${{ libro.precio }}</strong>
                    </div>
                    
                    <div class="mt-auto">
                        <a href="{% url 'libros:detalle_libro' libro.id %}" class="btn btn-primary btn-sm w-100">
                            <i class="fas fa-eye"></i> Ver Detalles
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> No se encontraron libros con los criterios especificados. 
                Intenta ajustar los filtros de búsqueda.
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}